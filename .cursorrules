# Cursor Rules ‚Äî Next.js 16+ Frontend-Only Project

**‚öôÔ∏è This project uses structured rules in `.cursor/rules/` folder**

All detailed rules are organized in `.cursor/rules/*.mdc` files:
- `00_first_rule.mdc` - Mobile-first responsive design (MANDATORY)
- `0_architecture.mdc` - Project structure, stack, environment
- `1_theming.mdc` - Dark/light modes, color themes
- `2_responsive.mdc` - Mobile-first breakpoints & layouts
- `3_data_i18n_accessibility.mdc` - API, forms, i18n, a11y
- `4_testing_naming.mdc` - Testing, naming conventions, performance
- `5_cursor_scaffolding.mdc` - Code generation templates
- `6_animations_skeleton.mdc` - Animation system & skeleton loading
- `7_definition_of_done.mdc` - QA checklist
- `8_mcp_tools.mdc` - **MCP Tools usage (MANDATORY)**

## üöÄ Quick Reference

### Project Details
- **Name**: MangaSBS (msbs)
- **Tech Stack**: Next.js 16.0.8, React 19.2.1, TypeScript 5, TailwindCSS 4, shadcn/ui
- **Package Manager**: Yarn 4.12.0
- **Dev Server**: PORT 3001 with Turbopack
- **Build**: Turbopack production builds
- **Testing**: Jest + Testing Library (80% coverage threshold)

### Core Stack
Next.js 16+, React 19, TypeScript 5, TailwindCSS 4, shadcn/ui, Jotai, Zod, RHF, next-intl, Jest, ESLint, Prettier, TipTap, Firebase Auth, Axios, Sonner, Mermaid, TanStack Query, framer-motion.

### Frontend-Only Rules (CRITICAL)
- ‚ùå **NO** Server Actions (`"use server"`)
- ‚ùå **NO** `app/api/*` routes
- ‚ùå **NO** secrets/DB SDKs in client
- ‚úÖ **ONLY** `NEXT_PUBLIC_*` environment variables
- ‚úÖ **ALL** network through `src/lib/http/client.ts`

### Quick Commands
```bash
yarn dev          # Start dev server (PORT=3001 with turbopack)
yarn build        # Build for production with turbopack
yarn start        # Start production server (PORT=3001)
yarn lint         # Run linter (ESLint)
yarn format       # Format code (Prettier)
yarn type-check   # TypeScript type checking
yarn test         # Run tests (Jest + RTL, ‚â•80% coverage)
yarn test:watch   # Run tests in watch mode
yarn test:coverage # Run tests with coverage report
```

### Key Principles
1. **MCP Tools First** ‚ö†Ô∏è MANDATORY - Always use MCP tools when available (see `8_mcp_tools.mdc`)
2. **Mobile-first** - Base styles for mobile (< 640px), scale up with `sm`/`md`/`lg`/`xl`/`2xl`
3. **Theme-aware** - Use shadcn tokens, no hardcoded colors (13 themes: Neutral, Stone, Zinc, Gray, Slate, Red, Rose, Orange, Green, Blue, Yellow, Violet, Dracula)
4. **i18n-first** - All text from `src/i18n/locales/{en,vi}/*.json` (18 namespaces: admin, article, auth, characters, comments, common, demo, home, media, organizations, permissions, profile, series, settings, tags, toast, user, write)
5. **Type-safe** - TypeScript strict mode, Zod validation
6. **Accessible** - AA contrast, keyboard nav, ARIA labels

### Breakpoints (Mobile-First)
- `sm`: ‚â• 640px (small tablets, large phones)
- `md`: ‚â• 768px (tablets)
- `lg`: ‚â• 1024px (small laptops, desktops)
- `xl`: ‚â• 1280px (large desktops)
- `2xl`: ‚â• 1536px (extra large screens)

### File Structure
```
src/
‚îú‚îÄ‚îÄ app/ (App Router pages)
‚îÇ   ‚îú‚îÄ‚îÄ admin/ (Admin panel - 15+ management sections)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics/ (Analytics dashboard)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ badges/ (Badge management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ characters/ (Character management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comments/ (Comment moderation)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ content/ (Content management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ genres/ (Genre management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ key-value/ (Key-value storage)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx (Admin layout)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ media/ (Media management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ organizations/ (Organization management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permissions/ (Permission management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate-limit/ (Rate limit management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reports/ (Report management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ segments/ (Segment management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ series/ (Series management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stickers/ (Sticker management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ studios/ (Studio management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tags/ (Tag management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/ (User management)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx (Admin dashboard)
‚îÇ   ‚îú‚îÄ‚îÄ article/ (Article viewing pages)
‚îÇ   ‚îú‚îÄ‚îÄ auth/ (Authentication - login/register/callback)
‚îÇ   ‚îú‚îÄ‚îÄ organizations/ (Organization pages)
‚îÇ   ‚îú‚îÄ‚îÄ segments/ (Segment pages)
‚îÇ   ‚îú‚îÄ‚îÄ series/ (Series pages)
‚îÇ   ‚îú‚îÄ‚îÄ settings/ (User settings)
‚îÇ   ‚îú‚îÄ‚îÄ user/ (User profiles)
‚îÇ   ‚îú‚îÄ‚îÄ write/ (Article writing)
‚îÇ   ‚îî‚îÄ‚îÄ theme-*/ (Theme testing pages)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ animate-ui/ (Animated UI components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/ (Radix components with animations)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ primitives/ (Animated primitives)
‚îÇ   ‚îú‚îÄ‚îÄ features/ (Business logic components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/ (129 admin components across all sections)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ article/ (Article components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/ (Authentication components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comments/ (Comment components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ genres/ (Genre components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ media/ (Media handling components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navigation/ (Site navigation)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reactions/ (Like/reaction components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ segments/ (Segment components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ series/ (Series management components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings/ (Settings components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stickers/ (Sticker components)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ text-editor/ (TipTap editor components)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ write/ (Writing components)
‚îÇ   ‚îú‚îÄ‚îÄ providers/ (Context providers)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth-provider.tsx (Firebase Auth)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ font-provider.tsx (Google Fonts)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ google-one-tap-provider.tsx (Google One Tap)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ i18n-provider.tsx (next-intl)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loading-provider.tsx (Loading states)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ no-ssr.tsx (No SSR wrapper)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate-limit-provider.tsx (Rate limiting)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ react-query-provider.tsx (TanStack Query)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ theme-provider.tsx (Theme management)
‚îÇ   ‚îú‚îÄ‚îÄ shared/ (Reusable utilities)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ animated-grid.tsx (Animated grid)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ animated-header.tsx (Animated header)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ animated-section.tsx (Animated section)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ skeletonize.tsx (Skeleton loading)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ translated-text.tsx (i18n wrapper)
‚îÇ   ‚îî‚îÄ‚îÄ ui/ (shadcn/ui components - 16+ core components)
‚îÇ       ‚îú‚îÄ‚îÄ core/ (15+ core UI primitives)
‚îÇ       ‚îú‚îÄ‚îÄ layout/ (Dialogs, forms, navigation)
‚îÇ       ‚îú‚îÄ‚îÄ navigation/ (Breadcrumb, sidebar, nav)
‚îÇ       ‚îú‚îÄ‚îÄ theme/ (Theme switchers, color pickers)
‚îÇ       ‚îú‚îÄ‚îÄ utilities/ (Utility components)
‚îÇ       ‚îî‚îÄ‚îÄ dracula/ (Dracula theme variants)
‚îú‚îÄ‚îÄ hooks/ (Custom React hooks - 30+ hooks)
‚îÇ   ‚îú‚îÄ‚îÄ admin/ (Admin-specific hooks - 16 hooks)
‚îÇ   ‚îú‚îÄ‚îÄ article/ (Article hooks)
‚îÇ   ‚îú‚îÄ‚îÄ auth/ (Auth hooks)
‚îÇ   ‚îú‚îÄ‚îÄ bookmarks/ (Bookmark hooks)
‚îÇ   ‚îú‚îÄ‚îÄ characters/ (Character hooks)
‚îÇ   ‚îú‚îÄ‚îÄ comments/ (Comment hooks)
‚îÇ   ‚îú‚îÄ‚îÄ content/ (Content rendering hooks)
‚îÇ   ‚îú‚îÄ‚îÄ follow/ (Follow hooks)
‚îÇ   ‚îú‚îÄ‚îÄ genres/ (Genre hooks)
‚îÇ   ‚îú‚îÄ‚îÄ media/ (Media handling hooks)
‚îÇ   ‚îú‚îÄ‚îÄ notifications/ (Notification hooks)
‚îÇ   ‚îú‚îÄ‚îÄ organizations/ (Organization hooks)
‚îÇ   ‚îú‚îÄ‚îÄ permissions/ (Permission hooks)
‚îÇ   ‚îú‚îÄ‚îÄ reactions/ (Reaction hooks)
‚îÇ   ‚îú‚îÄ‚îÄ reports/ (Report hooks)
‚îÇ   ‚îú‚îÄ‚îÄ segments/ (Segment hooks)
‚îÇ   ‚îú‚îÄ‚îÄ series/ (Series hooks)
‚îÇ   ‚îú‚îÄ‚îÄ settings/ (Settings hooks)
‚îÇ   ‚îú‚îÄ‚îÄ share/ (Share hooks)
‚îÇ   ‚îú‚îÄ‚îÄ tags/ (Tag hooks)
‚îÇ   ‚îú‚îÄ‚îÄ ui/ (UI hooks - page metadata, breadcrumbs)
‚îÇ   ‚îî‚îÄ‚îÄ users/ (User hooks)
‚îú‚îÄ‚îÄ i18n/ (Internationalization)
‚îÇ   ‚îî‚îÄ‚îÄ locales/ (Translation files)
‚îÇ       ‚îú‚îÄ‚îÄ en/ (18 JSON files)
‚îÇ       ‚îî‚îÄ‚îÄ vi/ (18 JSON files)
‚îú‚îÄ‚îÄ lib/ (Utilities, API, stores)
‚îÇ   ‚îú‚îÄ‚îÄ api/ (API wrappers - 23 files)
‚îÇ   ‚îú‚îÄ‚îÄ auth/ (Firebase Auth config)
‚îÇ   ‚îú‚îÄ‚îÄ config/ (Configuration files)
‚îÇ   ‚îú‚îÄ‚îÄ constants/ (App constants)
‚îÇ   ‚îú‚îÄ‚îÄ http/ (HTTP client + interceptors)
‚îÇ   ‚îú‚îÄ‚îÄ interface/ (TypeScript interfaces - 19 files)
‚îÇ   ‚îú‚îÄ‚îÄ mocks/ (Mock data)
‚îÇ   ‚îú‚îÄ‚îÄ rate-limit/ (Rate limiting utilities)
‚îÇ   ‚îú‚îÄ‚îÄ types/ (TypeScript types - 9 files)
‚îÇ   ‚îú‚îÄ‚îÄ utils/ (Utility functions - 14 files)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ animations.ts (Animation utilities)
‚îÇ   ‚îî‚îÄ‚îÄ validators/ (Zod schemas - 13 files)
‚îî‚îÄ‚îÄ __tests__/ (Jest + RTL tests)
    ‚îú‚îÄ‚îÄ admin/ (Admin tests)
    ‚îÇ   ‚îú‚îÄ‚îÄ genres/ (Genre tests)
    ‚îÇ   ‚îî‚îÄ‚îÄ genres.spec.tsx
    ‚îî‚îÄ‚îÄ features/ (Feature tests)
        ‚îî‚îÄ‚îÄ stickers/ (Sticker tests)
```

### Theme Tokens (Never Hardcode Colors)
| Use | Token |
|-----|--------|
| Background | `bg-background` |
| Text | `text-foreground` |
| Card | `bg-card text-card-foreground` |
| Border | `border-border` |
| Muted | `text-muted-foreground` |
| Hover | `hover:bg-accent hover:text-accent-foreground` |
| Focus Ring | `focus-visible:ring-ring` |

### Data & i18n Patterns
- **TanStack Query** for all client-side data fetching (5min staleTime, 10min gcTime, 3 retries, exponential backoff)
- **Query Keys**: Structured keys like `["article", articleId]`, `["settings", userId]`
- **HTTP Client**: Axios with interceptors, base URL from `NEXT_PUBLIC_API_BASE_URL`
- **Forms**: RHF + Zod + shadcn `<Form />` primitives
- **i18n**: `useI18n()` hook, `t(key: string, namespace?: string, variables?, fallback?)`
- **Error Handling**: Automatic retry with toast notifications via Sonner

### Animation System
- **Global Animation System** with framer-motion (AnimatedSection, AnimatedGrid, AnimatedHeader)
- **Skeleton Loading** with Skeletonize component and CSS shimmer animations
- **Animation variants** keep `opacity: 1` in hidden state for skeleton visibility

### Build & Development
- **Turbopack**: Used for both development and production builds
- **Standalone Output**: Next.js configured for containerized deployment
- **Image Optimization**: Configured with AniList CDN patterns and WebP/AVIF support
- **Font Optimization**: 10+ Google fonts loaded with Next.js font optimization
- **DevTools**: TanStack Query devtools enabled in development

---

**üìö For detailed rules, see `.cursor/rules/*.mdc` files**
